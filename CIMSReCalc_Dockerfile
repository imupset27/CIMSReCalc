# FIRST WORKING VERSION

FROM rocker/shiny:4.0.0

WORKDIR /srv/shiny-server/app


RUN apt-get update && apt-get install -y git

# Install stable packages from CRAN
RUN install2.r --error \
    shiny \
    auth0 \
    data.table \
    glue \
    readxl \
    zoo \
    dplyr
    
# Set up environment variable for GitHub credentials
ARG GITHUB_PAT
ARG GITHUB_USERNAME
ARG GITHUB_FILE
ENV GITHUB_PAT=${GITHUB_PAT}

# Clone the GitHub repository
RUN git clone https://imupset27:${GITHUB_PAT}@github.com/imupset27/CIMSReCalc_Final.git /srv/shiny-server/app

# Set options for finding auth0 config file
RUN echo "options(auth0_find_config_file = '/srv/shiny-server/app/_auth0.yml')" > /usr/local/lib/R/etc/Rprofile.site


# Run the app
CMD ["R", "-e", "shiny::runApp('/srv/shiny-server/app/', host='0.0.0.0', port=7860)"]

# SECOND WORKING VERSION


FROM rocker/shiny:4.0.0

WORKDIR /srv/shiny-server/app

RUN apt-get update && apt-get install -y git

RUN install2.r --error \
    shiny \
    auth0 \
    data.table \
    glue \
    readxl \
    zoo \
    dplyr

ARG GITHUB_PAT
ARG GITHUB_UN
ARG GITHUB_FILE
ENV GITHUB_PAT=${GITHUB_PAT}
ENV GITHUB_UN=${GITHUB_UN}
ENV GITHUB_FILE=${GITHUB_FILE}

RUN git clone https://${GITHUB_UN}:${GITHUB_PAT}@github.com/${GITHUB_UN}/${GITHUB_FILE}.git /srv/shiny-server/app

RUN echo "options(auth0_find_config_file = '/srv/shiny-server/app/_auth0.yml')" > /usr/local/lib/R/etc/Rprofile.site

CMD ["R", "-e", "shiny::runApp('.', host='0.0.0.0', port=7860)"]

# THIRD WORKING VERSION

FROM rocker/shiny:4.0.0

WORKDIR /srv/shiny-server/app

RUN apt-get update && apt-get install -y git

RUN install2.r --error \
    shiny \
    auth0 \
    data.table \
    glue \
    readxl \
    zoo \
    dplyr

ARG PAT
ARG UN
ARG FILE
ENV PAT=${PAT}
ENV UN=${UN}
ENV FILE=${FILE}

RUN git clone https://${UN}:${PAT}@github.com/${UN}/${FILE}.git /srv/shiny-server/app

RUN echo "options(auth0_find_config_file = '/srv/shiny-server/app/_auth0.yml')" > /usr/local/lib/R/etc/Rprofile.site

CMD ["R", "-e", "shiny::runApp('.', host='0.0.0.0', port=7860)"]
